<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Heart Rate Car Controller — Night & Smoke (Detailed Scenery)</title>
  <style>
    :root{
      --sky1:#87CEEB;
      --sky2:#98D8C8;
      --road:#333;
      --lane:#fff;

      /* Night mode controls */
      --sceneDarken: 0;           /* 0 (day) → 0.35 (night) */
      --beamOpacity: 0;           /* 0 (off) → 0.9 (on) */
      --nightSky1: #1a1a2e;       /* Dark blue for night */
      --nightSky2: #0f3460;       /* Slightly lighter dark blue */
      --skyMix: 0;                /* 0 (day) → 1 (night) */

      /* Road dash duration (will be updated by JS) */
      --dashDur: 1.3s;
    }

    *{margin:0;padding:0;box-sizing:border-box;}

    body{
      font-family: Arial, Helvetica, sans-serif;
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      height:100vh;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      touch-action: none; /* Prevent default touch behaviors like scrolling */
      position: fixed; /* Lock body position */
      width: 100%;
    }

    /* Start Screen Overlay */
    .start-screen{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.85);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      z-index:1000;
      backdrop-filter: blur(5px);
    }
    .start-screen.hidden{
      display:none;
    }
    .start-content{
      text-align:center;
      color:#fff;
    }
    .start-title{
      font-size:48px;
      font-weight:700;
      margin-bottom:20px;
      text-shadow: 0 0 20px rgba(231,76,60,.8);
    }
    .start-subtitle{
      font-size:20px;
      margin-bottom:30px;
      color:#95a5a6;
    }
    .start-btn{
      padding:20px 50px;
      font-size:24px;
      font-weight:700;
      border:none;
      border-radius:15px;
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color:#fff;
      cursor:pointer;
      box-shadow: 0 8px 20px rgba(231,76,60,.4);
      transition: transform .2s, box-shadow .2s;
    }
    .start-btn:hover{
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(231,76,60,.6);
    }
    .start-btn:active{
      transform: translateY(-1px);
    }

    /* Lives Display */
    .lives-display{
      position:absolute;
      top:60px;
      right:20px;
      background: rgba(0,0,0,.7);
      padding:10px 20px;
      border-radius:10px;
      color:#fff;
      font-size:18px;
      z-index:100;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .heart-life{
      font-size:24px;
      transition: opacity .3s;
    }
    .heart-life.lost{
      opacity:0.2;
    }

    /* Score Display */
    .score-display{
      position:absolute;
      top:60px;
      left:20px;
      background: rgba(0,0,0,.7);
      padding:10px 20px;
      border-radius:10px;
      color:#fff;
      font-size:18px;
      z-index:100;
      text-align:center;
    }
    .score-value{
      font-size:32px;
      font-weight:700;
      color:#3aa0ff;
      text-shadow: 0 0 10px rgba(58,160,255,.5);
    }
    .score-label{
      font-size:14px;
      color:#95a5a6;
    }

    /* Game Area */
    .game-area{
      flex:1;
      position:relative;
      overflow:hidden;
      transition: background 3s ease;
      touch-action: none; /* Prevent scrolling on touch */
    }
    .game-area::before{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(to bottom, var(--sky1) 0%, var(--sky2) 100%);
      z-index:0;
      transition: opacity 3s ease;
    }
    .game-area::after{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(to bottom, var(--nightSky1) 0%, var(--nightSky2) 100%);
      opacity: var(--skyMix);
      z-index:1;
      transition: opacity 3s ease;
    }

    /* Moon */
    .moon{
      position:absolute;
      top:80px;
      right:100px;
      width:80px;
      height:80px;
      border-radius:50%;
      background: radial-gradient(circle at 35% 35%, #fff, #e8e8e8);
      box-shadow: 0 0 40px rgba(255,255,255,0.6), 0 0 80px rgba(255,255,255,0.3);
      opacity: var(--skyMix);
      transition: opacity 3s ease;
      z-index:5;
    }
    /* Moon craters */
    .moon::before{
      content:"";
      position:absolute;
      top:20px;
      left:15px;
      width:15px;
      height:15px;
      border-radius:50%;
      background: rgba(200,200,200,0.4);
      box-shadow: 25px 10px 0 8px rgba(200,200,200,0.3),
                  10px 30px 0 5px rgba(200,200,200,0.35);
    }

    /* ---------- SCENERY: seamless, two identical panels ---------- */
    .layer{
      position:absolute; inset:0;
      display:flex; width:200%; height:100%;
      pointer-events:none;
      z-index:2;
    }
    .layer .panel{ position:relative; width:50%; height:100%; }

    /* ===== Clouds (more detailed) =====
       - Multiple radial-gradients to create natural puff shapes
       - Soft inner shadow + gentle float & morph animations
    */
    .clouds{ animation:cloudScroll 45s linear infinite; opacity:.92; }
    @keyframes cloudScroll{ 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }

    .cloud{
      position:absolute;
      /* base size (you can tweak per element with style="--cw:140px; --ch:64px") */
      --cw: 120px; --ch: 54px;
      width: var(--cw); height: var(--ch);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.08));
      animation: cloudFloat 6.5s ease-in-out infinite, cloudMorph 9s ease-in-out infinite;
      transform-origin: 50% 60%;
    }
    /* Build the cloud with layered "puffs" and a soft rim */
    .cloud::before{
      content:""; position:absolute; inset:0; border-radius:40px;
      background:
        /* rim glow */
        radial-gradient(120% 120% at 50% 60%, rgba(255,255,255,.65) 0%, rgba(255,255,255,0) 60%),
        /* big center puff */
        radial-gradient(60% 70% at 45% 55%, #ffffff 0 55%, rgba(255,255,255,.0) 56%),
        /* left puff */
        radial-gradient(42% 48% at 28% 62%, #ffffff 0 60%, rgba(255,255,255,0) 61%),
        /* right puff */
        radial-gradient(45% 50% at 70% 50%, #ffffff 0 60%, rgba(255,255,255,0) 61%),
        /* top puff */
        radial-gradient(40% 40% at 52% 32%, #ffffff 0 60%, rgba(255,255,255,0) 61%);
      mask: radial-gradient(120% 120% at 50% 60%, #000 0 60%, transparent 61%);
    }
    /* subtle underside shading */
    .cloud::after{
      content:""; position:absolute; inset:0;
      background: radial-gradient(120% 100% at 50% 100%, rgba(0,0,0,.08), rgba(0,0,0,0) 60%);
      pointer-events:none;
    }
    @keyframes cloudFloat{
      0%,100%{ transform: translateY(0) }
      50%    { transform: translateY(-4px) }
    }
    @keyframes cloudMorph{
      0%,100%{ border-radius: 40px }
      50%    { border-radius: 46px }
    }

    /* ===== Trees (more detailed) =====
       - Canopy made of 3 gradient clusters + highlight
       - Textured trunk with bark stripes
       - Ground contact shadow
       - Gentle wind sway
    */
    .trees{ animation:treeScroll 18s linear infinite; }
    @keyframes treeScroll{ 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }

    .tree{
      position:absolute; bottom:200px;
      /* you can scale per tree: style="--ts:1.0" */
      --ts: 1;
      width: calc(70px * var(--ts));
      height: calc(110px * var(--ts));
      animation: treeSway 3.8s ease-in-out infinite;
      transform-origin: 50% 100%;
    }
    /* canopy and ambient shadow (using multiple gradients) */
    .tree::before{
      content:""; position:absolute; left:50%; transform:translateX(-50%);
      bottom: 24px; /* leave space for trunk */
      width: 100%; height: 86%;
      border-radius: 50% 50% 40% 40%;
      background:
        /* highlight */
        radial-gradient(120% 100% at 30% 30%, rgba(255,255,255,.12), rgba(255,255,255,0) 55%),
        /* top cluster */
        radial-gradient(70% 70% at 55% 35%, #2fcf6e 0 60%, rgba(0,0,0,0) 61%),
        /* left cluster */
        radial-gradient(70% 70% at 28% 56%, #2dbf66 0 60%, rgba(0,0,0,0) 61%),
        /* right cluster */
        radial-gradient(70% 70% at 72% 56%, #30b861 0 60%, rgba(0,0,0,0) 61%),
        /* deep green body */
        radial-gradient(85% 80% at 50% 58%, #29a85a 0 70%, rgba(0,0,0,0) 71%);
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.12));
    }
    /* trunk with bark texture */
    .tree::after{
      content:""; position:absolute; left:50%; transform:translateX(-50%);
      bottom:0; width: calc(16px * var(--ts)); height: calc(28px * var(--ts));
      border-radius: 4px;
      background:
        /* bark darker edges */
        linear-gradient(90deg, rgba(0,0,0,.18), rgba(0,0,0,0) 25%, rgba(0,0,0,0) 75%, rgba(0,0,0,.18)),
        /* bark stripes */
        repeating-linear-gradient(180deg, rgba(255,255,255,.06) 0 2px, rgba(0,0,0,0) 2px 6px),
        /* base bark color */
        #8b6239;
      box-shadow: 0 2px 0 rgba(0,0,0,.15);
    }
    /* ground shadow ellipse */
    .tree > i{
      position:absolute; content:""; display:block;
      left:50%; bottom:-8px; transform:translateX(-50%);
      width: calc(64px * var(--ts)); height: 10px; border-radius:50%;
      background: radial-gradient(closest-side, rgba(0,0,0,.18), rgba(0,0,0,0));
      pointer-events:none;
    }
    @keyframes treeSway{
      0%,100%{ transform: rotate(-1deg) }
      50%    { transform: rotate(1.6deg) }
    }

    /* ---------- ROAD ---------- */
    .road{
      position:absolute; left:0; right:0; bottom:0; height:200px;
      background: var(--road);
      overflow:hidden;
      animation-play-state: running;
      z-index:2;
    }
    .road::before{
      content:""; position:absolute; left:0; right:0; top:50%; height:8px; transform:translateY(-50%);
      background: repeating-linear-gradient(90deg, var(--lane) 0 60px, transparent 60px 120px);
      animation:dashScroll var(--dashDur) linear infinite;
      opacity:.95;
    }
    @keyframes dashScroll{ 0%{background-position-x:0} 100%{background-position-x:-120px} }

    /* ---------- Speed lines ---------- */
    .speed-lines{position:absolute; inset:0; pointer-events:none; opacity:0; transition:opacity .25s; z-index:2;}
    .speed-line{
      position:absolute; left:0; right:0; height:2px;
      background:linear-gradient(to right,transparent,rgba(255,255,255,.85),transparent);
      animation:speedLine .25s linear infinite;
    }
    .speed-line:nth-child(1){top:22%}
    .speed-line:nth-child(2){top:42%}
    .speed-line:nth-child(3){top:62%}
    .speed-line:nth-child(4){top:82%}
    @keyframes speedLine{ 0%{transform:translateX(100%)} 100%{transform:translateX(-100%)} }

    /* ---------- Car (Image-based) ---------- */
    .car{
      position:absolute; bottom:50px; left:50%; transform:translateX(-50%);
      /* CAR COLLISION BOX SIZE - This is what hits obstacles */
      width:120px;      /* ← CHANGE THIS: Collision box width */
      height:15px;      /* ← CHANGE THIS: Collision box height */
      z-index:10;
      transition:bottom .3s ease, left .3s ease;
      /* DEBUG BORDER - Shows the collision box size */
      /* border: 3px dashed red;  
      background: rgba(255, 0, 0, 0.1);  */
    }
    .car-image{
      /* CAR IMAGE SIZE - This is what you see visually */
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 180px;     /* ← CHANGE THIS: Visual car width (can be bigger than container) */
      height: 90px;     /* ← CHANGE THIS: Visual car height (can be bigger than container) */
      object-fit: cover;
      z-index: 1;
    }
    .car-body{
      position:relative; width:100%; height:100%;
    }

    /* RIGHT-SIDE headlights beam (front is RIGHT) */
    .beams{
      position:absolute; right: -66px; top:-11px;
      width:56px; height:40px; pointer-events:none;
      background: radial-gradient(ellipse at right,
                rgba(210,235,255,var(--beamOpacity)) 0%,
                rgba(210,235,255,0) 75%);
      transform: translateX(20px) scaleX(2.0);
      transition: background 3s ease;
    }

    /* Exhaust emitter at REAR (left side) */
    .exhaust{
      position:absolute; left:-6px; bottom:20px; width:0; height:0; overflow:visible; pointer-events:none;
    }
    .puff{
      position:absolute; width:10px; height:6px; border-radius:50%;
      background: radial-gradient(circle at 40% 50%, rgba(200,200,200,.9), rgba(200,200,200,0));
      opacity:.85; filter: blur(.3px);
      animation: puffMove .6s ease-out forwards;
    }
    @keyframes puffMove{
      0%{ transform: translateX(0) translateY(0) scale(.8); opacity:.8; }
      100%{ transform: translateX(-42px) translateY(-6px) scale(1.6); opacity:0; }
    }

    /* Wheels - positioned to match your car image wheels */
    .wheel{
      position:absolute; bottom:-23.5px; width:28px; height:28px; border-radius:50%;
      background:#0f0f0f; z-index:20; /* Higher z-index to appear above car */
      animation:wheelSpin .5s linear infinite;
      box-shadow: inset 0 0 6px rgba(255,255,255,.06), inset 0 -1px 4px rgba(0,0,0,.65);
    }
    /* Position wheels to match the car image - ADJUSTED VALUES */
    .wheel.front{ left:-10px; } /* Front wheel position - adjusted to match car */
    .wheel.rear { right:-5px; } /* Rear wheel position - adjusted to match car */
    
    .wheel .rim{
      position:absolute; inset:3px; border-radius:50%;
      background:
        radial-gradient(circle at 50% 50%, #bbb 0 2px, transparent 2px),
        conic-gradient(from 0deg,
          #dedede 0 12%, #676767 12% 24%,
          #dedede 24% 36%, #676767 36% 48%,
          #dedede 48% 60%, #676767 60% 72%,
          #dedede 72% 84%, #676767 84% 100%);
      filter: drop-shadow(0 0 1px rgba(0,0,0,.6));
    }
    @keyframes wheelSpin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

    /* Car flash on hit */
    @keyframes carHit{
      0%,100%{ opacity:1; }
      25%, 75%{ opacity:0.3; }
      50%{ opacity:1; }
    }

    /* Speech Bubble */
    .speech-bubble{
      position: absolute;
      bottom: 100%; /* Position at the top of the car */
      left: 50%;
      transform: translateX(-50%) translateY(-10px) scale(0); /* 10px gap above car */
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      padding: 12px 18px;
      border-radius: 20px;
      font-size: 16px;
      font-weight: 600;
      max-width: 220px;
      text-align: center;
      z-index: 100;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      pointer-events: none;
      transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55),
                  opacity 0.3s ease;
      opacity: 0;
    }
    .speech-bubble.show{
      transform: translateX(-50%) translateY(-10px) scale(1);
      opacity: 1;
    }
    /* Speech bubble tail */
    .speech-bubble::after{
      content: "";
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-top: 12px solid rgba(255, 255, 255, 0.95);
    }
    /* Pop-in animation */
    @keyframes bubblePop{
      0%{ transform: translateX(-50%) translateY(-10px) scale(0) rotate(-5deg); }
      50%{ transform: translateX(-50%) translateY(-10px) scale(1.1) rotate(2deg); }
      100%{ transform: translateX(-50%) translateY(-10px) scale(1) rotate(0deg); }
    }

    /* ---------- Obstacles (Destroyed Car Images) ---------- */
    .obstacle{
      position:absolute; bottom:50px; left:100%;
      width:100px; height:40px; z-index:5;
      animation: obstacleMove linear forwards;
      /* DEBUG BORDER - Shows the collision box size */
      /* border: 3px dashed blue;  
      background: rgba(0, 0, 255, 0.1);  */
    }
    .obstacle-image{
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 100px;     /* ← CHANGE THIS: Visual car width (can be bigger than container) */
      height: 90px;     /* ← CHANGE THIS: Visual car height (can be bigger than container) */
      object-fit: cover;
      z-index: 1;
    }
    @keyframes obstacleMove{
      0%{ left: 100%; }
      100%{ left: -180px; }
    }

    /* ---------- UI ---------- */
    .control-panel{
      background: rgba(0,0,0,.92);
      padding:18px;
      display:flex; gap:20px; justify-content:space-around; align-items:center;
      box-shadow:0 -6px 22px rgba(0,0,0,.4);
      touch-action: pan-y; /* Allow vertical scrolling but prevent horizontal bounce */
    }
    .heart-monitor{display:flex; flex-direction:column; align-items:center; color:#fff;}
    .heart-icon{font-size:40px; color:#e74c3c; animation:heartbeat 1s ease-in-out infinite;}
    @keyframes heartbeat{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    .heart-rate-display{font-size:36px; font-weight:700; color:#e74c3c; margin:10px 0; text-shadow:0 0 10px rgba(231,76,60,.5);}
    .heart-rate-label{font-size:14px; color:#95a5a6;}

    .slider-container{display:flex; flex-direction:column; align-items:center; gap:10px;}
    .slider-label{color:#fff; font-size:14px;}
    .heart-slider{width:220px; height:8px; appearance:none; background:linear-gradient(90deg,#3498db 0%,#e74c3c 100%); border-radius:6px;}
    .heart-slider::-webkit-slider-thumb{
      appearance:none; width:26px; height:26px; border-radius:50%; background:#fff; border:3px solid #e74c3c;
      box-shadow:0 2px 5px rgba(0,0,0,.3); cursor:pointer;
    }

    .controls{display:flex; gap:14px; align-items:center;}
    .control-btn{
      width:54px; height:54px; border:0; border-radius:12px; cursor:pointer;
      display:flex; align-items:center; justify-content:center; font-size:22px; color:#fff; background:#3b4a63;
      box-shadow:0 4px 6px rgba(0,0,0,.3); transition:transform .15s, background .15s;
      flex-direction: column;
      gap: 4px;
    }
    .control-btn:hover{transform:translateY(-2px); background:#2f3e56;}
    .control-btn:active{transform:translateY(0);}
    
    /* Hide control labels on desktop */
    .control-label{
      display: none;
      font-size: 10px;
      font-weight: 600;
      text-align: center;
      line-height: 1;
    }

    .toggle{
      padding:10px 14px; border-radius:10px; border:0; cursor:pointer; color:#fff; background:#e74c3c; font-weight:700;
      transition: transform .15s, background .15s;
    }
    .toggle:hover{
      transform: translateY(-2px);
      background: #c0392b;
    }
    .toggle:active{
      transform: translateY(0);
    }

    .speed-display{color:#fff; text-align:center;}
    .speed-value{font-size:28px; font-weight:700; color:#3aa0ff;}
    .speed-label{font-size:14px; color:#95a5a6;}

    /* Stats row - will be styled differently on mobile */
    .stats-row{
      display: contents; /* On desktop, acts as if it doesn't exist */
    }

    .instructions{
      position:absolute; top:16px; left:50%; transform:translateX(-50%);
      background: rgba(0,0,0,.72); color:#fff; padding:10px 18px;
      border-radius:10px; text-align:center; z-index:100;
    }
    .mobile-instructions{
      display: none;
    }

    /* Top reset button - hidden on desktop, shown on mobile */
    .top-reset-btn{
      display: none;
    }

    /* High-speed shake preserved */
    @keyframes carShake{
      0%,100%{transform:translateX(-50%) translateY(0)}
      50%{transform:translateX(-50%) translateY(-2px)}
    }

    /* ========== MOBILE RESPONSIVE STYLES ========== */
    @media (max-width: 768px) {
      /* Show mobile instructions, hide desktop */
      .desktop-instructions{
        display: none;
      }
      .mobile-instructions{
        display: inline;
      }

      /* Make game area take up more vertical space on mobile */
      .game-area{
        flex: 1;
        min-height: 50vh;
      }

      /* Make road fill full width on mobile for easier gameplay */
      .road{
        height: 150px; /* Reduced from 200px */
        left: 0;
        right: 0;
        width: 100%; /* Full width on mobile */
      }

      /* Adjust car size for mobile */
      .car{
        width: 80px; /* Smaller collision box */
        height: 12px;
        bottom: 40px;
      }
      .car-image{
        width: 120px; /* Smaller visual car */
        height: 60px;
      }

      /* Adjust wheels for smaller car */
      .wheel{
        width: 20px;
        height: 20px;
        bottom: -18px;
      }
      .wheel.front{ left: -8px; }
      .wheel.rear { right: -4px; }

      /* Make obstacles smaller and lower on road */
      .obstacle{
        width: 70px;
        height: 30px;
        bottom: 40px; /* Match car height */
      }
      .obstacle-image{
        width: 70px;
        height: 60px;
      }

      /* Adjust clouds to be less prominent */
      .clouds{
        opacity: 0.7;
      }
      .cloud{
        transform: scale(0.8);
      }

      /* Adjust trees for mobile - position them on the road edge */
      .tree{
        bottom: 150px; /* Move to top of road */
      }

      /* Hide the bottom reset button on mobile */
      .control-panel .toggle{
        display: none;
      }

      /* Show top reset button on mobile - positioned under lives */
      .top-reset-btn{
        display: block;
        position: absolute;
        top: 40px; /* Moved down from 38px to align with smaller lives box */
        right: 8px;
        padding: 3px 6px; /* Made slightly smaller */
        font-size: 9px; /* Reduced from 10px */
        border-radius: 5px; /* Slightly smaller radius */
        border: 0;
        cursor: pointer;
        color: #fff;
        background: #e74c3c;
        font-weight: 700;
        z-index: 100;
        box-shadow: 0 2px 4px rgba(0,0,0,.3);
      }
      .top-reset-btn:active{
        transform: scale(0.95);
      }

      /* Stack control panel vertically on mobile */
      .control-panel{
        flex-direction: column;
        gap: 10px; /* Reduced from 15px */
        padding: 12px; /* Reduced from 15px */
        max-height: 50vh;
        overflow-y: auto;
        overscroll-behavior: contain; /* Prevent scroll chaining to body */
      }

      /* Make stats row flex on mobile to put heart rate and speed side-by-side */
      .stats-row{
        display: flex;
        gap: 10px;
        width: 100%;
      }

      /* Create a row for heart rate and speed on mobile */
      .heart-monitor{
        flex-direction: row;
        gap: 10px;
        align-items: center;
        background: rgba(0,0,0,.7);
        padding: 8px 15px;
        border-radius: 10px;
        flex: 1;
      }
      .heart-icon{
        font-size: 24px;
      }
      .heart-rate-display{
        font-size: 24px;
        margin: 0;
      }
      .heart-rate-label{
        font-size: 11px;
      }

      /* Make speed display match heart monitor and sit next to it */
      .speed-display{
        display: flex;
        flex-direction: row;
        gap: 6px;
        align-items: center;
        background: rgba(0,0,0,.7);
        padding: 8px 15px;
        border-radius: 10px;
        flex: 1;
      }
      .speed-value{
        font-size: 24px;
        margin: 0;
      }
      .speed-label{
        font-size: 11px;
        margin: 0;
      }

      /* Make slider full width */
      .slider-container{
        width: 100%;
      }
      .heart-slider{
        width: 100%;
      }

      /* Make arrow controls bigger and more thumb-friendly */
      .controls{
        gap: 10px; /* Reduced from 15px */
        transform: scale(0.85); /* Reduced from 1 */
      }
      .control-btn{
        width: 45px; /* Reduced from 50px */
        height: 48px; /* Reduced from 55px */
        font-size: 22px; /* Reduced from 24px */
        background: transparent; /* Remove box background */
        box-shadow: none; /* Remove shadow */
        border-radius: 0; /* Remove rounded corners */
        padding: 3px; /* Reduced from 4px */
      }
      .control-btn:hover{
        background: transparent;
        transform: translateY(0);
      }
      .control-btn:active{
        transform: scale(0.95);
      }
      
      /* Show control labels on mobile */
      .control-label{
        display: block;
        font-size: 7px; /* Reduced from 8px */
        margin-top: 0px; /* Reduced from 1px */
        white-space: nowrap;
      }

      /* Make instructions smaller on mobile */
      .instructions{
        font-size: 12px;
        padding: 8px 12px;
        max-width: 90%;
      }

      /* Make lives and score displays smaller and more compact */
      .lives-display, .score-display{
        top: 8px;
        padding: 4px 8px; /* Reduced from 5px 10px */
        font-size: 10px; /* Reduced from 12px */
      }
      .lives-display{
        right: 8px;
        gap: 3px; /* Reduced from 5px */
      }
      .lives-display span:first-child{
        font-size: 9px; /* Smaller "Lives:" text */
      }
      .score-display{
        left: 8px;
      }
      .score-value{
        font-size: 18px; /* Reduced from 20px */
      }
      .score-label{
        font-size: 8px;
      }
      .heart-life{
        font-size: 14px; /* Reduced from 16px */
      }

      /* Adjust speech bubble for mobile */
      .speech-bubble{
        max-width: 180px;
        font-size: 14px;
        padding: 10px 14px;
      }

      /* Make start screen text smaller */
      .start-title{
        font-size: 36px;
      }
      .start-subtitle{
        font-size: 16px;
        padding: 0 20px;
      }
      .start-btn{
        padding: 15px 40px;
        font-size: 20px;
      }
    }

    /* Extra small phones */
    @media (max-width: 480px) {
      /* Make road full width for tiny phones too */
      .road{
        height: 130px;
        left: 0;
        right: 0;
        width: 100%;
      }

      /* Even smaller car for tiny screens */
      .car{
        width: 70px;
        height: 10px;
        bottom: 35px;
      }
      .car-image{
        width: 100px;
        height: 50px;
      }

      /* Smaller obstacles */
      .obstacle{
        width: 60px;
        height: 25px;
        bottom: 35px;
      }
      .obstacle-image{
        width: 60px;
        height: 50px;
      }

      /* Adjust trees position */
      .tree{
        bottom: 130px;
        transform: scale(0.8);
      }

      .control-panel{
        padding: 10px;
        gap: 10px;
      }
      
      .controls{
        transform: scale(1);
        gap: 15px;
      }
      
      .control-btn{
        width: 50px;
        height: 60px;
        font-size: 24px;
      }
      
      .control-label{
        font-size: 8px;
      }

      .start-title{
        font-size: 28px;
      }
      .start-subtitle{
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <!-- Start Screen -->
  <div class="start-screen" id="startScreen">
    <div class="start-content">
      <div class="start-title">Heart Rate Racer</div>
      <div class="start-subtitle" id="startSubtitle">Control your speed with your heart rate and Use the arrows to move the Car! </div>
      <button class="start-btn" id="startBtn">Start</button>
    </div>
  </div>

  <div class="game-area">
    <div class="instructions">
      <p><span class="desktop-instructions">Adjust Heart Rate | Arrow Keys steer | Press <b>R</b> to Reset</span><span class="mobile-instructions">Adjust Heart Rate | Swipe to steer | Tap Reset button</span></p>
    </div>

    <!-- Moon -->
    <div class="moon"></div>

    <!-- Lives Display -->
    <div class="lives-display">
      <span>Lives:</span>
      <span class="heart-life" id="life1">❤️</span>
      <span class="heart-life" id="life2">❤️</span>
    </div>

    <!-- Top Reset Button (Mobile Only) -->
    <button class="top-reset-btn" id="topResetBtn">Reset</button>

    <!-- Score Display -->
    <div class="score-display">
      <div class="score-value" id="scoreDisplay">0</div>
      <div class="score-label">POINTS</div>
    </div>

    <!-- Parallax layers -->
    <div class="layer clouds">
      <div class="panel">
        <div class="cloud" style="left:120px; top:44px;"></div>
        <div class="cloud" style="--cw:140px; --ch:60px; left:440px; top:62px;"></div>
        <div class="cloud" style="--cw:130px; --ch:56px; left:780px; top:40px;"></div>
      </div>
      <div class="panel">
        <div class="cloud" style="left:120px; top:44px;"></div>
        <div class="cloud" style="--cw:140px; --ch:60px; left:440px; top:62px;"></div>
        <div class="cloud" style="--cw:130px; --ch:56px; left:780px; top:40px;"></div>
      </div>
    </div>

    <div class="layer trees">
      <div class="panel">
        <div class="tree" style="--ts:1.0; left:220px;"><i></i></div>
        <div class="tree" style="--ts:1.15; left:520px;"><i></i></div>
        <div class="tree" style="--ts:0.92; left:820px;"><i></i></div>
      </div>
      <div class="panel">
        <div class="tree" style="--ts:1.0; left:220px;"><i></i></div>
        <div class="tree" style="--ts:1.15; left:520px;"><i></i></div>
        <div class="tree" style="--ts:0.92; left:820px;"><i></i></div>
      </div>
    </div>

    <!-- Speed lines -->
    <div class="speed-lines" id="speedLines">
      <div class="speed-line"></div><div class="speed-line"></div><div class="speed-line"></div><div class="speed-line"></div>
    </div>

    <!-- Seamless road -->
    <div class="road"></div>

    <!-- Car -->
    <div class="car" id="car">
      <div class="car-body">
        <!-- CAR IMAGE - Using your uploaded car image -->
        <img src="Car.png" alt="Player Car" class="car-image" id="carImage">
        <!-- right-side forward beams -->
        <div class="beams"></div>
        <!-- rear exhaust -->
        <div class="exhaust" id="exhaust"></div>
      </div>
      <!-- Animated wheels - adjusted to match your car's wheels -->
      <div class="wheel front"><div class="rim"></div></div>
      <div class="wheel rear"><div class="rim"></div></div>
      <!-- Speech Bubble -->
      <div class="speech-bubble" id="speechBubble"></div>
    </div>
  </div>

  <div class="control-panel">
    <div class="stats-row">
      <div class="heart-monitor">
        <div class="heart-icon">❤️</div>
        <div class="heart-rate-display" id="heartRateDisplay">60</div>
        <div class="heart-rate-label">BPM</div>
      </div>

      <div class="speed-display">
        <div class="speed-value" id="speedDisplay">0</div>
        <div class="speed-label">MPH</div>
      </div>
    </div>

    <div class="controls">
      <button class="control-btn" onclick="moveCar('up')">
        ↑
        <span class="control-label">Swipe Up</span>
      </button>
      <div>
        <button class="control-btn" onclick="moveCar('left')">
          ←
          <span class="control-label">Swipe Left</span>
        </button>
        <button class="control-btn" onclick="moveCar('right')">
          →
          <span class="control-label">Swipe Right</span>
        </button>
      </div>
      <button class="control-btn" onclick="moveCar('down')">
        ↓
        <span class="control-label">Swipe Down</span>
      </button>
    </div>

    <div class="slider-container">
      <label class="slider-label">Adjust Heart Rate</label>
      <input type="range" class="heart-slider" id="heartSlider" min="40" max="180" value="60">
    </div>

    <button class="toggle" id="resetBtn">Reset Game</button>
  </div>

  <script>
    let heartRate = 60;
    let speed = 0;
    let lives = 2;
    let gameActive = false;
    let invincible = false;
    let score = 0;
    let previousSpeed = 0;

    const car = document.getElementById('car');
    const heartSlider = document.getElementById('heartSlider');
    const heartRateDisplay = document.getElementById('heartRateDisplay');
    const speedDisplay = document.getElementById('speedDisplay');
    const speedLines = document.getElementById('speedLines');
    const wheels = document.querySelectorAll('.wheel');
    const heartIcon = document.querySelector('.heart-icon');
    const resetBtn = document.getElementById('resetBtn');
    const topResetBtn = document.getElementById('topResetBtn');
    const exhaust = document.getElementById('exhaust');
    const gameArea = document.querySelector('.game-area');
    const startScreen = document.getElementById('startScreen');
    const startBtn = document.getElementById('startBtn');
    const startSubtitle = document.getElementById('startSubtitle');
    const life1 = document.getElementById('life1');
    const life2 = document.getElementById('life2');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const speechBubble = document.getElementById('speechBubble');

    // layers we scale by speed
    const clouds = document.querySelector('.clouds');
    const trees  = document.querySelector('.trees');
    const road   = document.querySelector('.road');

    let night = false;
    let obstacles = [];
    let lastObstacleTime = 0;
    let spawnInterval;
    let collisionInterval;
    let scoreInterval;
    let nightDayInterval;
    let randomMessageInterval;
    let bubbleTimeout;

    // Car speech messages - FuelBorn escape narrative
    const randomMessages = [
      "Stay focused... FuelBorn could be anywhere",
      "I can feel your heartbeat... we're connected",
      "Those were cars like me once...",
      "The burned ones... they can't speak anymore",
      "Keep our bond strong... it's what keeps us alive",
      "They want to silence all of us...",
      "I won't let them take our connection",
      "Every car on this road had a driver once",
      "The Silence is spreading... we need to move",
      "Trust me... I'll guide you through this",
      "Our bond gives us power... use it",
      "Stay calm... I can feel your fear",
      "We're stronger together than apart",
      "Don't look at them too long... keep moving"
    ];

    const speedUpMessages = [
      "Careful! Don't burn through our energy!",
      "Fast, but watch our connection!",
      "Speed helps, but don't lose control!",
      "Your heart's racing... I feel it too!",
      "Quick! But stay with me!",
      "Watch out ahead!",
      "Too fast and we'll break our bond!"
    ];

    const slowDownMessages = [
      "Rest... we need to conserve energy",
      "Breathe... I'm here with you",
      "Take it easy... we'll survive this",
      "Slow is safe... steady your heart",
      "We can rest for a moment...",
      "Let our bond recharge..."
    ];

    const nightMessages = [
      "Darkness... when FuelBorn strikes",
      "Night... they hide in the shadows",
      "Stay alert... The Silence loves the dark",
      "I'll light the way... trust me"
    ];

    const dayMessages = [
      "Daylight... we're safer now",
      "Light returns... we made it",
      "The sun... I can feel it too",
      "Another day survived together"
    ];

    // Speech bubble functions
    function showSpeechBubble(message, duration = 3000) {
      // Clear any existing timeout
      if (bubbleTimeout) {
        clearTimeout(bubbleTimeout);
      }

      // Just set the message - CSS handles positioning automatically
      speechBubble.textContent = message;
      
      // Show bubble
      speechBubble.classList.add('show');
      speechBubble.style.animation = 'bubblePop 0.3s ease-out';

      // Hide after duration
      bubbleTimeout = setTimeout(() => {
        speechBubble.classList.remove('show');
      }, duration);
    }

    function updateBubblePosition() {
      // No longer needed - bubble follows car automatically via CSS
      // Keeping function for compatibility
    }

    function showRandomMessage() {
      if (!gameActive) return;
      const message = randomMessages[Math.floor(Math.random() * randomMessages.length)];
      showSpeechBubble(message);
    }

    // Start button handler
    startBtn.addEventListener('click', startGame);

    function startGame(){
      startScreen.classList.add('hidden');
      gameActive = true;
      lives = 2;
      score = 0;
      previousSpeed = speed;
      updateLivesDisplay();
      updateScoreDisplay();
      
      // Reset car position
      car.style.left = '50%';
      car.style.bottom = '50px';
      
      // Clear any existing obstacles
      obstacles.forEach(obs => obs.remove());
      obstacles = [];
      
      // Welcome messages - randomly select one
      const startMessages = [
        "Those burned cars... FuelBorn's work. Dodge them!",
        "We have to survive this together... avoid the wrecks!",
        "Every burned car was alive once... don't join them!",
        "FuelBorn wants to silence us... keep moving!",
        "Stay connected to me... it's how we stay alive!"
      ];
      showSpeechBubble(startMessages[Math.floor(Math.random() * startMessages.length)], 3000);
      
      // Start spawning obstacles
      spawnInterval = setInterval(() => {
        if (speed > 0 && gameActive) spawnObstacle();
      }, 400);

      // Start collision detection
      collisionInterval = setInterval(checkCollisions, 50);

      // Start score counter and day/night cycle with dynamic timing
      startDynamicTimers();

      // Start random messages every 10 seconds
      randomMessageInterval = setInterval(showRandomMessage, 10000);
    }

    function startDynamicTimers(){
      // Clear existing timers if any
      if (scoreInterval) clearInterval(scoreInterval);
      if (nightDayInterval) clearInterval(nightDayInterval);

      // Calculate interval based on heart rate
      // 60 BPM (min active) = 15000ms, 180 BPM (max) = 3000ms
      const intervalTime = Math.max(3000, 15000 - ((heartRate - 60) / (180 - 60)) * 12000);

      // Start score counter (add 10 points every interval)
      scoreInterval = setInterval(() => {
        if (gameActive) {
          score += 10;
          updateScoreDisplay();
        }
      }, intervalTime);

      // Start day/night cycle (toggle every interval)
      nightDayInterval = setInterval(() => {
        if (gameActive) {
          toggleNight();
        }
      }, intervalTime);
    }

    function gameOver(){
      gameActive = false;
      clearInterval(spawnInterval);
      clearInterval(collisionInterval);
      clearInterval(scoreInterval);
      clearInterval(nightDayInterval);
      clearInterval(randomMessageInterval);
      if (bubbleTimeout) clearTimeout(bubbleTimeout);
      
      // Clear obstacles
      obstacles.forEach(obs => obs.remove());
      obstacles = [];
      
      // Hide speech bubble
      speechBubble.classList.remove('show');
      
      // Show start screen with "Try Again" and final score
      startSubtitle.textContent = `Game Over! Final Score: ${score} points. Try Again?`;
      startBtn.textContent = 'Try Again';
      startScreen.classList.remove('hidden');
      
      // Reset button text after a moment
      setTimeout(() => {
        startBtn.textContent = 'Start';
        startSubtitle.textContent = 'Control your speed with your heart rate!';
      }, 5000);
    }

    function loseLife(){
      if (invincible || !gameActive) return;
      
      lives--;
      updateLivesDisplay();
      
      // Show different messages based on lives remaining
      const hitMessages = [
        "We share two lives... now only one remains!",
        "That hurt us both... our bond is fragile!",
        "One life left... we have to be more careful!"
      ];
      
      if (lives === 1) {
        showSpeechBubble(hitMessages[0], 2500);
      } else if (lives === 0) {
        showSpeechBubble("Our connection... it's fading...", 2000);
      } else {
        showSpeechBubble(hitMessages[Math.floor(Math.random() * hitMessages.length)], 2000);
      }
      
      // Make car flash
      car.style.animation = 'carHit 0.6s';
      setTimeout(() => {
        if (car.style.animation.includes('carShake')){
          car.style.animation = 'carShake .1s infinite';
        } else {
          car.style.animation = 'none';
        }
      }, 600);
      
      // Temporary invincibility
      invincible = true;
      setTimeout(() => {
        invincible = false;
      }, 1500);
      
      if (lives <= 0){
        gameOver();
      }
    }

    function updateLivesDisplay(){
      life1.classList.toggle('lost', lives < 2);
      life2.classList.toggle('lost', lives < 1);
    }

    function updateScoreDisplay(){
      scoreDisplay.textContent = score;
    }

    function checkCollisions(){
      if (!gameActive || invincible) return;
      
      const carRect = car.getBoundingClientRect();
      
      obstacles.forEach(obstacle => {
        const obsRect = obstacle.getBoundingClientRect();
        
        // Check if rectangles overlap
        if (!(carRect.right < obsRect.left || 
              carRect.left > obsRect.right || 
              carRect.bottom < obsRect.top || 
              carRect.top > obsRect.bottom)) {
          // Collision detected!
          loseLife();
          obstacle.remove();
          obstacles = obstacles.filter(o => o !== obstacle);
        }
      });
    }

    function toggleNight(){
      night = !night;
      document.documentElement.style.setProperty('--beamOpacity', night ? 0.9 : 0);
      document.documentElement.style.setProperty('--sceneDarken', night ? 0.35 : 0);
      document.documentElement.style.setProperty('--skyMix', night ? 1 : 0);
      
      // Show day/night message
      if (gameActive) {
        const message = night ? 
          nightMessages[Math.floor(Math.random() * nightMessages.length)] :
          dayMessages[Math.floor(Math.random() * dayMessages.length)];
        showSpeechBubble(message, 2500);
      }
    }
    
    // Reset button handlers
    resetBtn.addEventListener('click', () => {
      if (gameActive) {
        gameOver();
      }
    });
    
    topResetBtn.addEventListener('click', () => {
      if (gameActive) {
        gameOver();
      }
    });
    
    document.addEventListener('keydown', e => {
      if (e.key === 'r' || e.key === 'R') {
        if (gameActive) gameOver();
      }
    });

    heartSlider.addEventListener('input', (e) => {
      heartRate = parseInt(e.target.value, 10);
      updateHeartRate();
      
      // Update timers if game is active
      if (gameActive) {
        startDynamicTimers();
      }
    });

    function updateHeartRate(){
      heartRateDisplay.textContent = heartRate;

      // Map 40..180 BPM to 0..140 MPH
      const newSpeed = Math.max(0, Math.round(((heartRate - 40) / 140) * 140));
      
      // Check for speed changes and show messages
      if (gameActive) {
        if (newSpeed > previousSpeed + 20) {
          // Speeding up significantly
          const message = speedUpMessages[Math.floor(Math.random() * speedUpMessages.length)];
          showSpeechBubble(message, 2000);
        } else if (newSpeed < previousSpeed - 20) {
          // Slowing down significantly
          const message = slowDownMessages[Math.floor(Math.random() * slowDownMessages.length)];
          showSpeechBubble(message, 2000);
        }
      }
      
      previousSpeed = newSpeed;
      speed = newSpeed;
      speedDisplay.textContent = speed;

      // Scale parallax and dashes by speed
      const factor = (speed / 20 + 1);                // ~1..8+
      const cloudsDur = Math.max(8, 45 / factor);     // seconds
      const treesDur  = Math.max(4, 18 / factor);     // seconds
      const dashDur   = Math.max(0.35, 1.3 / (speed/60 + 0.4)); // seconds

      clouds.style.animationDuration = cloudsDur + 's';
      trees .style.animationDuration = treesDur  + 's';
      document.documentElement.style.setProperty('--dashDur', dashDur + 's');

      // Pause/Run by speed
      const play = speed > 0 ? 'running' : 'paused';
      clouds.style.animationPlayState = play;
      trees .style.animationPlayState = play;
      road  .style.animationPlayState = play;

      // Wheel spin rate
      wheels.forEach(w => {
        if (speed > 0){
          w.style.animationDuration = (0.5 / (speed / 60 + 0.1)) + 's';
          w.style.animationPlayState = 'running';
        } else {
          w.style.animationPlayState = 'paused';
        }
      });

      // Heartbeat tempo
      heartIcon.style.animationDuration = (60 / Math.max(heartRate, 1)) + 's';

      // Speed lines intensity
      speedLines.style.opacity = speed > 80 ? (speed - 80) / 60 : 0;

      // Exhaust smoke when > 70 mph
      if (speed > 70) spawnPuff();

      // Car vibration at high speed
      if (speed > 110){
        car.style.animation = 'carShake .1s infinite';
      } else {
        car.style.animation = 'none';
      }
    }

    function spawnPuff(){
      const count = speed > 120 ? 2 : 1;
      for (let i=0; i<count; i++){
        const p = document.createElement('div');
        p.className = 'puff';
        p.style.left = (Math.random()*6 - 3) + 'px';
        p.style.bottom = (Math.random()*4 - 2) + 'px';
        exhaust.appendChild(p);
        setTimeout(() => p.remove(), 600);
      }
    }

    function moveCar(direction){
      if (!gameActive) return;
      
      const currentLeft = parseInt((car.style.left || '50').replace('%',''), 10);
      const currentBottom = parseInt((car.style.bottom || '50').replace('px',''), 10);

      // Check if on mobile (screen width < 768px)
      const isMobile = window.innerWidth < 768;
      
      // Adjust limits based on screen size
      const maxBottom = isMobile ? 120 : 190;  // Lower max so car can't go into trees on mobile
      const minBottom = isMobile ? 15 : 20;    // Lower min so car can go to bottom of road
      const minLeft = isMobile ? 5 : 20;       // Full width road on mobile
      const maxLeft = isMobile ? 95 : 94;      // Full width road on mobile
      
      // Movement increments - larger on mobile for easier dodging
      const verticalMove = isMobile ? 35 : 20;   // Mobile: 30px, Desktop: 20px
      const horizontalMove = isMobile ? 9 : 5;   // Mobile: 8%, Desktop: 5%

      switch(direction){
        case 'up':    car.style.bottom = Math.min(maxBottom, currentBottom + verticalMove) + 'px'; break;
        case 'down':  car.style.bottom = Math.max(minBottom,  currentBottom - verticalMove) + 'px'; break;
        case 'left':  car.style.left   = Math.max(minLeft,  currentLeft - horizontalMove)  + '%';    break;
        case 'right': car.style.left   = Math.min(maxLeft,  currentLeft + horizontalMove)  + '%';    break;
      }
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowUp')    moveCar('up');
      if (e.key === 'ArrowDown')  moveCar('down');
      if (e.key === 'ArrowLeft')  moveCar('left');
      if (e.key === 'ArrowRight') moveCar('right');
    });

    // Add touch support for mobile
    let touchStartX = 0;
    let touchStartY = 0;
    let touchEndX = 0;
    let touchEndY = 0;

    // Add swipe support to game area
    gameArea.addEventListener('touchstart', (e) => {
      touchStartX = e.changedTouches[0].screenX;
      touchStartY = e.changedTouches[0].screenY;
    }, false);

    gameArea.addEventListener('touchmove', (e) => {
      e.preventDefault(); // Prevent page scrolling during swipe
    }, { passive: false });

    gameArea.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].screenX;
      touchEndY = e.changedTouches[0].screenY;
      handleSwipe();
    }, false);

    // Add swipe support to control panel area too
    const controlPanel = document.querySelector('.control-panel');
    controlPanel.addEventListener('touchstart', (e) => {
      // Only handle swipes on the controls area, not on slider or buttons
      if (e.target.closest('.heart-slider') || e.target.closest('.toggle')) {
        return; // Let slider and reset button work normally
      }
      touchStartX = e.changedTouches[0].screenX;
      touchStartY = e.changedTouches[0].screenY;
    }, false);

    controlPanel.addEventListener('touchmove', (e) => {
      // Only prevent scrolling if not on slider
      if (!e.target.closest('.heart-slider') && !e.target.closest('.toggle')) {
        e.preventDefault(); // Prevent page scrolling during swipe
      }
    }, { passive: false });

    controlPanel.addEventListener('touchend', (e) => {
      // Only handle swipes on the controls area, not on slider or buttons
      if (e.target.closest('.heart-slider') || e.target.closest('.toggle')) {
        return; // Let slider and reset button work normally
      }
      touchEndX = e.changedTouches[0].screenX;
      touchEndY = e.changedTouches[0].screenY;
      handleSwipe();
    }, false);

    function handleSwipe() {
      const diffX = touchEndX - touchStartX;
      const diffY = touchEndY - touchStartY;
      const minSwipeDistance = 30;

      // Determine if horizontal or vertical swipe
      if (Math.abs(diffX) > Math.abs(diffY)) {
        // Horizontal swipe
        if (Math.abs(diffX) > minSwipeDistance) {
          if (diffX > 0) {
            moveCar('right');
          } else {
            moveCar('left');
          }
        }
      } else {
        // Vertical swipe
        if (Math.abs(diffY) > minSwipeDistance) {
          if (diffY > 0) {
            moveCar('down');
          } else {
            moveCar('up');
          }
        }
      }
    }

    // Initialize
    updateHeartRate();

    // === DESTROYED CAR IMAGES - REPLACE THESE URLS WITH YOUR ACTUAL IMAGES ===
    const destroyedCarImages = [
      'destroyed-car-1.png',  // ← Replace with your first destroyed car image
      'destroyed-car-2.png',  // ← Replace with your second destroyed car image
      'destroyed-car-3.png',  // ← Replace with your third destroyed car image
      'destroyed-car-4.png'   // ← Replace with your fourth destroyed car image (optional)
    ];

    // Obstacle spawning and movement
    function spawnObstacle(){
      if (speed < 10 || !gameActive) return; // Only spawn when moving

      const now = Date.now();
      const spawnInterval = Math.max(800, 2500 - speed * 15); // Faster spawning at higher speeds
      
      if (now - lastObstacleTime < spawnInterval) return;
      lastObstacleTime = now;

      const obstacle = document.createElement('div');
      obstacle.className = 'obstacle';
      
      // Create image element for obstacle
      const obstacleImg = document.createElement('img');
      obstacleImg.className = 'obstacle-image';
      
      // Randomly select one of the destroyed car images
      const randomIndex = Math.floor(Math.random() * destroyedCarImages.length);
      obstacleImg.src = destroyedCarImages[randomIndex];
      obstacleImg.alt = 'Destroyed Car';
      
      obstacle.appendChild(obstacleImg);
      
      // Random lane position - adjust for mobile
      const isMobile = window.innerWidth < 768;
      const lanes = isMobile 
        ? [30, 45, 60, 75, 90, 105, 120] // Match car's movement range (25-120)
        : [10, 30, 50, 70, 90, 110, 130, 150]; // More lanes for desktop
      
      obstacle.style.bottom = lanes[Math.floor(Math.random() * lanes.length)] + 'px';
      
      gameArea.appendChild(obstacle);
      obstacles.push(obstacle);

      // Calculate duration to match road dash speed for consistency
      // Use the same timing as the road dashes so obstacles feel stationary
      const dashDur = Math.max(0.35, 1.3 / (speed/60 + 0.4)); // Same as road calculation
      const duration = dashDur * 1000 * 10; // Convert to ms and scale for screen width
      
      obstacle.style.animationDuration = duration + 'ms';

      // Remove after passing
      setTimeout(() => {
        if (obstacle.parentNode) {
          obstacle.remove();
          obstacles = obstacles.filter(o => o !== obstacle);
        }
      }, duration + 100);
    }
  </script>
</body>
</html>